<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Blaze Video Intelligence</title>
    <link rel="stylesheet" href="/css/brand.css">
    <link rel="stylesheet" href="/css/components.css">
    <script src="/js/analytics.js"></script>
    <style>
        .upload-area {
            border: 2px dashed var(--line);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            text-align: center;
            background: var(--panel);
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--accent);
            background: rgba(191, 87, 0, 0.05);
        }
        
        .upload-area input[type="file"] {
            display: none;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin-top: var(--space-lg);
        }
        
        .video-preview {
            width: 100%;
            max-height: 400px;
            border-radius: var(--radius-md);
            background: var(--oil);
            border: 1px solid var(--line);
        }
        
        .metrics-panel {
            background: var(--panel);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            border: 1px solid var(--line);
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--line);
        }
        
        .metric-row:last-child {
            border-bottom: none;
        }
        
        .overlay-canvas {
            position: relative;
            background: var(--oil);
            border: 1px solid var(--line);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-ready {
            background: rgba(0, 178, 169, 0.1);
            color: var(--teal);
            border: 1px solid rgba(0, 178, 169, 0.3);
        }
        
        .status-processing {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        @media (max-width: 768px) {
            .analysis-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <a href="/" class="logo">ðŸ”¥ Blaze Intelligence</a>
        <div class="nav-links">
            <a href="/artifacts/blaze-dashboard.html">Live Dashboard</a>
            <a href="/api-docs">API Docs</a>
            <a href="/app" class="btn">Back to App</a>
        </div>
    </nav>

    <div class="container">
        <header style="text-align: center; margin: var(--space-xl) 0;">
            <h1>Video Intelligence â€” Digital Combineâ„¢</h1>
            <p class="muted">Upload a clip to analyze swing mechanics, hip-shoulder separation, launch angles, and kinematic sequencing.</p>
            <div class="status-indicator status-ready">
                <span class="live-dot" style="background: var(--teal);"></span>
                System Ready
            </div>
        </header>

        <!-- Upload Section -->
        <section class="panel">
            <form id="upload-form" enctype="multipart/form-data">
                <div class="upload-area" onclick="document.getElementById('video-file').click()">
                    <input type="file" id="video-file" name="video" accept="video/*" required />
                    <div style="font-size: 3rem; margin-bottom: var(--space-md);">ðŸ“¹</div>
                    <h3 style="margin: 0 0 var(--space-sm) 0;">Upload Video for Analysis</h3>
                    <p class="muted">Drop a video file here or click to browse</p>
                    <div class="tiny muted" style="margin-top: var(--space-md);">
                        Supported formats: MP4, MOV, AVI â€¢ Max size: 100MB
                    </div>
                </div>
                
                <div class="row" style="margin-top: var(--space-lg); gap: var(--space-md);">
                    <select class="input" name="analysisType" required>
                        <option value="">Select Analysis Type</option>
                        <option value="swing">Swing Analysis</option>
                        <option value="pitch">Pitching Mechanics</option>
                        <option value="batting">Batting Stance</option>
                        <option value="fielding">Fielding Position</option>
                    </select>
                    <input class="input" type="text" name="team" placeholder="Team ID (e.g., STL)" />
                    <input class="input" type="text" name="playerName" placeholder="Player Name" />
                    <button class="btn" type="submit">
                        <span id="submit-text">Start Analysis</span>
                        <div id="submit-spinner" class="spinner" style="display: none;"></div>
                    </button>
                </div>
            </form>
        </section>

        <!-- Analysis Results -->
        <div class="analysis-grid">
            <!-- Video Preview -->
            <section class="panel">
                <h3 style="margin: 0 0 var(--space-md) 0;">Video Preview</h3>
                <video id="video-preview" class="video-preview" controls style="display: none;">
                    Your browser does not support the video tag.
                </video>
                <div id="video-placeholder" class="video-preview" style="display: flex; align-items: center; justify-content: center; color: var(--muted);">
                    Upload a video to see preview
                </div>
            </section>

            <!-- Analysis Metrics -->
            <section class="metrics-panel">
                <h3 style="margin: 0 0 var(--space-md) 0;">Analysis Metrics</h3>
                <div id="metrics-content">
                    <div class="metric-row">
                        <span class="muted">Exit Velocity</span>
                        <span id="exit-velocity" class="mono">-- mph</span>
                    </div>
                    <div class="metric-row">
                        <span class="muted">Launch Angle</span>
                        <span id="launch-angle" class="mono">-- Â°</span>
                    </div>
                    <div class="metric-row">
                        <span class="muted">Bat Speed</span>
                        <span id="bat-speed" class="mono">-- mph</span>
                    </div>
                    <div class="metric-row">
                        <span class="muted">Power Rating</span>
                        <span id="power-rating" class="mono">-- / 100</span>
                    </div>
                    <div class="metric-row">
                        <span class="muted">Hip-Shoulder Separation</span>
                        <span id="hip-shoulder" class="mono">-- Â°</span>
                    </div>
                </div>
                <div id="recommendations" style="margin-top: var(--space-lg); display: none;">
                    <h4 style="margin: 0 0 var(--space-sm) 0;">Recommendations</h4>
                    <ul id="recommendations-list" style="margin: 0; padding-left: var(--space-lg); color: var(--muted);"></ul>
                </div>
            </section>
        </div>

        <!-- Live Overlay Preview -->
        <section class="panel" style="margin-top: var(--space-lg);">
            <h3 style="margin: 0 0 var(--space-md) 0;">Live Overlay Preview</h3>
            <div class="overlay-canvas">
                <canvas id="overlay" width="960" height="540" style="width: 100%; height: 300px;"></canvas>
            </div>
            <div class="tiny muted" style="margin-top: var(--space-sm);">
                Real-time biomechanical tracking overlay (demo visualization)
            </div>
        </section>

        <!-- Analysis Output -->
        <section class="panel" style="margin-top: var(--space-lg);">
            <h3 style="margin: 0 0 var(--space-md) 0;">Analysis Output</h3>
            <pre id="analysis-output" class="tiny mono" style="background: var(--oil); padding: var(--space-md); border-radius: var(--radius-sm); white-space: pre-wrap; min-height: 100px; color: var(--muted);">
Waiting for analysis results...
            </pre>
        </section>
    </div>

    <script>
        // File upload handling
        const uploadForm = document.getElementById('upload-form');
        const videoFile = document.getElementById('video-file');
        const videoPreview = document.getElementById('video-preview');
        const videoPlaceholder = document.getElementById('video-placeholder');
        const analysisOutput = document.getElementById('analysis-output');
        const submitBtn = uploadForm.querySelector('button[type="submit"]');
        const submitText = document.getElementById('submit-text');
        const submitSpinner = document.getElementById('submit-spinner');

        // Drag and drop functionality
        const uploadArea = document.querySelector('.upload-area');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), false);
        });

        uploadArea.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                videoFile.files = files;
                handleFileSelect(files[0]);
            }
        });

        // File selection handling
        videoFile.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            if (file && file.type.startsWith('video/')) {
                const url = URL.createObjectURL(file);
                videoPreview.src = url;
                videoPreview.style.display = 'block';
                videoPlaceholder.style.display = 'none';
                
                // Track file upload
                if (window.BlazeAnalytics) {
                    window.BlazeAnalytics.trackFileUpload(file.type, file.size);
                }
            }
        }

        // Form submission
        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!videoFile.files[0]) {
                alert('Please select a video file first');
                return;
            }

            // Update UI to show processing
            submitBtn.disabled = true;
            submitText.textContent = 'Processing...';
            submitSpinner.style.display = 'inline-block';
            analysisOutput.textContent = 'Uploading and analyzing video...';

            try {
                const formData = new FormData(uploadForm);
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (response.ok) {
                    displayAnalysisResults(result);
                    
                    // Track successful analysis
                    if (window.BlazeAnalytics) {
                        window.BlazeAnalytics.track('video_analysis_complete', {
                            analysisType: formData.get('analysisType'),
                            fileSize: videoFile.files[0].size
                        });
                    }
                } else {
                    throw new Error(result.error || 'Analysis failed');
                }
            } catch (error) {
                analysisOutput.textContent = `Error: ${error.message}`;
                
                // Track error
                if (window.BlazeAnalytics) {
                    window.BlazeAnalytics.trackError(error, 'video_analysis');
                }
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitText.textContent = 'Start Analysis';
                submitSpinner.style.display = 'none';
            }
        });

        function displayAnalysisResults(result) {
            // Update analysis output
            analysisOutput.textContent = JSON.stringify(result, null, 2);
            
            // Update metrics (demo values)
            document.getElementById('exit-velocity').textContent = '94.2 mph';
            document.getElementById('launch-angle').textContent = '23.5Â°';
            document.getElementById('bat-speed').textContent = '71.8 mph';
            document.getElementById('power-rating').textContent = '87 / 100';
            document.getElementById('hip-shoulder').textContent = '45.3Â°';
            
            // Show recommendations
            const recommendations = document.getElementById('recommendations');
            const recommendationsList = document.getElementById('recommendations-list');
            recommendationsList.innerHTML = `
                <li>Increase hip rotation to improve power transfer</li>
                <li>Maintain consistent launch angle for optimal distance</li>
                <li>Focus on timing to maximize exit velocity</li>
            `;
            recommendations.style.display = 'block';
        }

        // Overlay demo animation
        const canvas = document.getElementById('overlay');
        const ctx = canvas.getContext('2d');
        
        function animateOverlay(timestamp) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw background grid
            ctx.strokeStyle = 'rgba(31, 41, 55, 0.5)';
            ctx.lineWidth = 1;
            for (let i = 0; i < canvas.width; i += 40) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < canvas.height; i += 40) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            
            // Animated elements
            const t = timestamp * 0.001;
            
            // Player silhouette (center)
            ctx.fillStyle = 'rgba(191, 87, 0, 0.7)';
            ctx.beginPath();
            ctx.arc(480, 270, 60, 0, Math.PI * 2);
            ctx.fill();
            
            // Swing arc
            ctx.strokeStyle = '#BF5700';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(480, 270, 120 + 10 * Math.sin(t * 2), 0, Math.PI * 1.5);
            ctx.stroke();
            
            // Force vectors
            ctx.strokeStyle = '#9BCBEB';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(480, 270);
            ctx.lineTo(480 + 100 * Math.cos(t), 270 + 100 * Math.sin(t));
            ctx.stroke();
            
            // Velocity indicator
            ctx.fillStyle = '#00B2A9';
            ctx.font = 'bold 16px monospace';
            ctx.fillText(`Velocity: ${(65 + 10 * Math.sin(t * 3)).toFixed(1)} mph`, 20, 30);
            
            requestAnimationFrame(animateOverlay);
        }
        
        requestAnimationFrame(animateOverlay);
    </script>
</body>
</html>